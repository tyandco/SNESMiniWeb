<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SNES Mini Menu</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    overflow-x: hidden;
    background: #1e1a17;
    font-family: 'Noto Sans', sans-serif;
  }

  /* Background scrolling wrapper */
  .scrolling-wrapper {
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  .scrolling-strip {
    display: flex;
    width: 200%;
    height: 100vh;
    animation: scroll-left 35s linear infinite;
  }

  .scrolling-strip img {
    width: 50%;
    height: 100vh;
    object-fit: cover;
    flex-shrink: 0;
    filter: blur(5px);
  }

  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* Overlay bars */
  .overlay-bars {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 10;
    object-fit: fill;
  }

  /* Centered text */
  .centered-text {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 20;
    color: white;
    width: 80%;
    font-size: 2em;
    font-weight: bold;
    text-align: center;
    pointer-events: none;
    text-shadow: 0 0 5px black;
  }

  /* GAME CAROUSEL fixed above all */
.game-carousel {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
  display: flex;
  justify-content: center; /* Center the slots */
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 20px;
  padding: 10px 20px;
  scrollbar-width: none;
  border-radius: 12px;
  max-width: 100vw;
  max-height: 330px; /* keep height so it doesnâ€™t grow too big */
}

  .game-carousel::-webkit-scrollbar {
    display: none;
  }

.game-slot {
  flex: 0 0 auto;
  width: 260px;   /* bigger width */
  height: 280px;  /* bigger height */
  /* Removed background-image settings */
  padding: 20px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  position: relative;
  color: white;
  transition: transform 0.3s ease;
  transform: scale(0.9); /* removed rotation */
}

/* New tinted background layer */
.game-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('gameslot.png');
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
  filter: none; /* no tint by default */
  z-index: 1;
}

.game-slot.selected .game-bg {
  filter: sepia(1) hue-rotate(170deg) saturate(4) brightness(0.9); /* tinted when selected */
}

.game-slot.selected {
  box-shadow: none;
  border: none;
  /* Removed redundant background-image settings */
  position: relative;
  z-index: 3;
  transform: scale(1); /* removed rotation */
}
.game-slot.selected::after,
.game-slot.selected::before {
  content: none !important;
  display: none !important;
}
.game-slot.selected .game-cover img {
  filter: none !important;
}
.game-slot.selected {
  content: none;
}

.game-cover {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 10px;
  width: 100%;
  height: 300px; /* set a fixed height for vertical centering */
  box-sizing: border-box;
  z-index: 2;
}

.game-cover img {
  max-width: 100%;
  max-height: 300px;
  margin: auto;
  display: block;
  object-fit: contain;
  z-index: 3;
}


.game-info {
  text-align: center;
}

.game-title {
  font-weight: bold;
  margin: 10px 0 6px;
}

.game-info a {
  text-decoration: none;
  background: #555;
  color: #fff;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.9em;
  transition: background 0.2s;
}

.game-info a:hover {
  background: #777;
}

/* Title bar at the top */
.title-bar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 300px;
  color: #000;
  font-size: 2.2em;
  font-weight: normal;
  text-align: center;
  line-height: 258px;
  z-index: 10000;
  letter-spacing: -0.02em;
  font-family: 'Noto Sans', sans-serif;
}

</style>
</head>
<body>
<div class="title-bar">SNES Mini Menu</div>

<div class="scrolling-wrapper">
  <div class="scrolling-strip">
    <img src="nintendo-classic-mini-uhd-4k-wallpaper.jpg" alt="Scrolling Background" />
    <img src="nintendo-classic-mini-uhd-4k-wallpaper.jpg" alt="Scrolling Background" />
  </div>

  <img src="snesmini topandbottom.png" alt="Overlay Bars" class="overlay-bars" />
  <div class="centered-text"></div>

  <!-- GAME CAROUSEL fixed at bottom -->
  <div class="game-carousel" id="gameCarousel"></div>
</div>

<audio id="bg-music" preload="auto" style="display:none;">
  <source src="02. Main Menu (SNES Classic Edition).mp3" type="audio/mpeg" />
</audio>

<script>
  // Audio loop setup
  const audio = document.getElementById('bg-music');
  const loopStart = 2; // seconds
  let loopEnd = 52.108;

  audio.addEventListener('loadedmetadata', () => {
    loopEnd = audio.duration;
    console.log('Audio duration:', loopEnd);
  });

  let started = false;
  function startAudio() {
    if (started) return;
    started = true;
    audio.currentTime = 0;
    audio.play().then(() => {
      console.log('Playback started');
    }).catch(e => console.error('Playback failed:', e));
  }

  window.addEventListener('click', startAudio, { once: true });
  window.addEventListener('keydown', startAudio, { once: true });

  audio.addEventListener('timeupdate', () => {
    if (audio.currentTime >= loopEnd - 0.05) {
      audio.pause();
      audio.currentTime = loopStart;
      audio.play().catch(e => console.error('Loop playback failed:', e));
    }
  });

  // Games array
  const games = [
    { title: "Super Mario World", cover: "images/smw.png", rom: "roms/smw.zip" },
    { title: "Zelda: A Link to the Past", cover: "images/zelda.png", rom: "roms/zelda.zip" },
    { title: "Donkey Kong Country", cover: "images/dkc.png", rom: "roms/dkc.zip" },
  ];

  const carousel = document.getElementById('gameCarousel');
  const titleBar = document.querySelector('.title-bar');
  let selectedIndex = 0;

  function updateSelectedSlot() {
    const slots = document.querySelectorAll('.game-slot');
    slots.forEach((slot, i) => {
      if (i % games.length === selectedIndex) {
        slot.classList.add('selected');
      } else {
        slot.classList.remove('selected');
      }
    });
  }

  function updateTitleBar(game) {
    if (titleBar && game) {
      titleBar.textContent = game.title;
    }
    updateSelectedSlot();
  }

  function createGameSlot(game, index) {
    const slot = document.createElement('div');
    slot.classList.add('game-slot');
    slot.innerHTML = `
      <div class="game-bg"></div>
      <div class="game-cover" style="margin-top:-10px;">
        <img src="${game.cover}" alt="${game.title}">
      </div>
      <div class="game-info">
        <a href="${game.rom}" download style="display:none;">Download ROM</a>
      </div>
    `;
    slot.tabIndex = 0;
    slot.addEventListener('focus', () => {
      updateTitleBar(game);
      selectedIndex = index;
    });
    slot.addEventListener('mouseenter', () => {
      updateTitleBar(game);
      selectedIndex = index;
    });
    // New click event to download the ROM when clicking the slot
    slot.addEventListener('click', () => {
      const anchor = document.createElement('a');
      anchor.href = game.rom;
      anchor.download = "";
      document.body.appendChild(anchor);
      anchor.click();
      document.body.removeChild(anchor);
    });
    return slot;
  }

  function populateCarousel() {
    carousel.innerHTML = '';
    games.forEach((game, i) => carousel.appendChild(createGameSlot(game, i)));
    updateTitleBar(games[0]);
    updateSelectedSlot();
  }

  populateCarousel();

  // Infinite scroll illusion for carousel
  carousel.scrollLeft = 0;
  carousel.addEventListener('scroll', () => {
    if (carousel.scrollLeft >= carousel.scrollWidth / 2) {
      carousel.scrollLeft = 0;
    }
  });
  // Keyboard navigation for carousel
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      selectedIndex = (selectedIndex + 1) % games.length;
      updateTitleBar(games[selectedIndex]);
    } else if (e.key === 'ArrowLeft') {
      selectedIndex = (selectedIndex - 1 + games.length) % games.length;
      updateTitleBar(games[selectedIndex]);
    }
    updateSelectedSlot();
  });
</script>

</body>
</html>
