<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SNES Mini Menu</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz@0,14..32;1,14..32&display=swap');
  
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    height: 100%;
    overflow-x: hidden;
    background: #1e1a17;
    font-family: 'Noto Sans', sans-serif;
  }

  /* Background scrolling wrapper */
  .scrolling-wrapper {
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
  }

  .scrolling-strip {
    display: flex;
    width: 200%;
    height: 100vh;
    animation: scroll-left 35s linear infinite;
  }

  .scrolling-strip img {
    width: 50%;
    height: 100vh;
    object-fit: cover;
    flex-shrink: 0;
    filter: blur(5px);
  }

  @keyframes scroll-left {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  /* Overlay bars */
  .overlay-bar {
    position: absolute;
    left: 0;
    width: 100%;
    height: auto;
    min-height: 0;
    pointer-events: none;
    z-index: 20;
    object-fit: contain;
  }
  .overlay-bar-top {
    top: 0;
    object-position: top left;
    height: auto;
    min-height: 0;
  }
  .overlay-bar-bottom {
    bottom: 0;
    object-position: bottom left;
    height: auto;
    min-height: 0;
  }

  /* Centered text */
  .centered-text {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 20;
    color: white;
    width: 80%;
    font-size: 2em;
    text-align: center;
    pointer-events: none;
    font-family: "Inter", sans-serif;
    font-optical-sizing: auto;
    font-weight: 500;
    font-style: normal;
    text-shadow: 0 0 5px black;
  }

  /* GAME CAROUSEL fixed above all */
.game-carousel {
  position: fixed;
  left: 0;
  right: 0;
  top: 55%;
  transform: translateY(-50%);
  z-index: 10;
  display: flex;
  justify-content: flex-start; /* Allow slots to start at left */
  overflow-x: auto;
  scroll-behavior: smooth;
  gap: 20px;
  padding: 10px 8vw; /* Add horizontal padding to keep slots away from edges */
  scrollbar-width: none;
  border-radius: 12px;
  max-width: 100vw;
  max-height: 330px; /* keep height so it doesnâ€™t grow too big */
  background: none;
  box-sizing: border-box;
}

  .game-carousel::-webkit-scrollbar {
    display: none;
  }

/* Prevent game slots from overflowing on small screens */
@media (max-width: 900px) {
  .game-carousel {
    max-width: 100vw;
    gap: 8px;
    padding: 10px 2vw; /* Less padding on small screens */
  }
  .game-slot {
    width: 180px;
    height: 180px;
    padding: 10px;
  }
}

.game-slot {
  flex: 0 0 auto;
  width: 260px;   /* bigger width */
  height: 280px;  /* bigger height */
  /* Removed background-image settings */
  padding: 20px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  position: relative;
  color: white;
  transition: transform 0.3s ease;
  transform: scale(0.9); /* removed rotation */
  cursor: pointer; /* Added cursor pointer */
}

/* New tinted background layer */
.game-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url('gameslot.png');
  background-repeat: no-repeat;
  background-position: center;
  background-size: contain;
  filter: none; /* no tint by default */
  z-index: 1;
}

.game-slot.selected .game-bg {
  filter: sepia(1) hue-rotate(170deg) saturate(4) brightness(0.9); /* tinted when selected */
}

.game-slot.selected {
  box-shadow: none;
  border: none;
  /* Removed redundant background-image settings */
  position: relative;
  z-index: 3;
  transform: scale(1); /* removed rotation */
}
.game-slot.selected::after,
.game-slot.selected::before {
  content: none !important;
  display: none !important;
}
.game-slot.selected .game-cover img {
  filter: none !important;
}
.game-slot.selected {
  content: none;
}

.game-cover {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 25px;
  width: 100%;
  height: 370px; /* set a fixed height for vertical centering */
  box-sizing: border-box;
  z-index: 2;
}

.game-cover img {
  max-width: 100%;
  max-height: 370px;
  display: block;
  object-fit: contain;
  z-index: 3;
}


.game-info {
  text-align: center;
}

.game-title {
  font-weight: bold;
  margin: 10px 0 6px;
}

.game-info a {
  text-decoration: none;
  background: #555;
  color: #fff;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.9em;
  transition: background 0.2s;
}

.game-info a:hover {
  background: #777;
}

/* Title bar at the top */
.title-bar {
  position: fixed;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100vw;
  max-width: 100vw;
  min-width: 100vw;
  height: 90px; /* Further reduced height */
  color: #000;
  font-size: 1.3em; /* Smaller font */
  font-weight: normal;
  text-align: center;
  line-height: 90px; /* Match new height */
  z-index: 10000;
  letter-spacing: -0.02em;
  font-family: 'Noto Sans', sans-serif;
  box-sizing: border-box;
  padding: 0;
}

/* New game title bar styles */
.gametitle-bar {
  position: absolute;
  top: 8vw;
  left: 50%;
  transform: translateX(-50%);
  width: 80vw;
  max-width: 80vw;
  height: 7vw;
  max-height: 90px;
  min-height: 44px;
  background: url('gametitlebar.png') center center no-repeat;
  background-size: 100% 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 21;
  pointer-events: none;
  box-sizing: border-box;
  padding: 0 0.5vw;
  image-rendering: pixelated;
  filter: contrast(1.2) brightness(1.1) saturate(1.3) grayscale(0.15);
}
.gametitle-bar .game-title-text {
  color: #000;
  font-size: clamp(1.2em, 2.5vw, 2.2em);
  font-family: "Inter", sans-serif;
  font-weight: 400;
  text-align: center;
  width: 96%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: auto;
}
@media (max-width: 700px) {
  .gametitle-bar {
    width: 100vw;
    max-width: 100vw;
    height: 13vw;
    min-height: 36px;
    padding: 0 0.5vw;
  }
  .gametitle-bar .game-title-text {
    font-size: clamp(1em, 4vw, 1.8em);
  }
}

/* Focus outline for accessibility */
.game-slot:focus {
  outline: none;
  box-shadow: none;
}
</style>
</head>
<body>
<div class="scrolling-wrapper">
  <div class="scrolling-strip">
    <img src="nintendo-classic-mini-uhd-4k-wallpaper.jpg" alt="Scrolling Background" />
    <img src="nintendo-classic-mini-uhd-4k-wallpaper.jpg" alt="Scrolling Background" />
  </div>

  <!-- Separate top and bottom bars -->
  <img src="topbar.png" alt="Top Bar" class="overlay-bar overlay-bar-top" />
  <img src="bottombar.png" alt="Bottom Bar" class="overlay-bar overlay-bar-bottom" />

  <!-- Game title bar below top bar -->
  <div class="gametitle-bar"><span class="game-title-text"></span></div>

  <div class="centered-text"></div>

  <!-- GAME CAROUSEL fixed at bottom -->
  <div class="game-carousel" id="gameCarousel"></div>
</div>

<audio id="bg-music" preload="auto" style="display:none;">
  <source src="02. Main Menu (SNES Classic Edition).mp3" type="audio/mpeg" />
</audio>
<audio id="sound-scroll" preload="auto" src="sounds/se_sys_click.wav" style="display:none;"></audio>
<audio id="sound-click" preload="auto" src="sounds/se_sys_click_game.wav" style="display:none;"></audio>

<script>
  // Audio loop setup
  const audio = document.getElementById('bg-music');
  const loopStart = 2; // seconds
  let loopEnd = 52.108;

  audio.addEventListener('loadedmetadata', () => {
    loopEnd = audio.duration;
    console.log('Audio duration:', loopEnd);
  });

  let started = false;
  function startAudio() {
    if (started) return;
    started = true;
    audio.currentTime = 0;
    audio.play().then(() => {
      console.log('Playback started');
    }).catch(e => console.error('Playback failed:', e));
  }

  window.addEventListener('click', startAudio, { once: true });
  window.addEventListener('keydown', startAudio, { once: true });

  audio.addEventListener('timeupdate', () => {
    if (audio.currentTime >= loopEnd - 0.05) {
      audio.pause();
      audio.currentTime = loopStart;
      audio.play().catch(e => console.error('Loop playback failed:', e));
    }
  });

  // Lower background music volume
audio.volume = 0.7; // Lower background music volume
const soundScroll = document.getElementById('sound-scroll');
const soundClick = document.getElementById('sound-click');
soundScroll.volume = 1.0; // Max volume for sound effects
soundClick.volume = 1.0;

// Ensure sounds are loaded and can play after user gesture
function unlockAudio(audioEl) {
  if (!audioEl) return;
  // Try to play and immediately pause to unlock
  audioEl.volume = 1;
  audioEl.currentTime = 0;
  audioEl.play().then(() => audioEl.pause()).catch(() => {});
}

function unlockAllAudio() {
  unlockAudio(soundScroll);
  unlockAudio(soundClick);
}

window.addEventListener('click', unlockAllAudio, { once: true });
window.addEventListener('keydown', unlockAllAudio, { once: true });

function playSound(sound) {
  if (!sound) return;
  try {
    sound.pause();
    sound.currentTime = 0;
    sound.play().catch(() => {});
  } catch (e) {}
}

// Games array
  const games = [
    { title: "Super Mario World", cover: "images/smw.png", rom: "roms/smw.zip" },
    { title: "Legend of Zelda, The - A Link to the Past", cover: "images/zelda.png", rom: "roms/zelda.zip" },
    { title: "Donkey Kong Country", cover: "images/dkc.png", rom: "roms/dkc.zip" },
    { title: "F-Zero", cover: "images/F-Zero (USA).png", rom: "roms/F-ZERO (U) [!].zip" },
    { title: "Kirby Super Star", cover: "images/Kirby Super Star (USA).png", rom: "roms/Kirby Super Star (U) [!].zip" },
    { title: "Kirby's Dream Land 3", cover: "images/Kirby's Dream Land 3 (USA).png", rom: "roms/Kirby's Dream Land 3 (U).zip" },
    { title: "Star Fox", cover: "images/Star Fox (USA).png", rom: "roms/Star Fox (U) (V1.2) [!].zip" },
    { title: "Star Fox 2", cover: "images/Star Fox 2 (USA).png", rom: "roms/Star Fox 2 (USA).zip" },
    { title: "Contra III - The Alien Wars", cover: "images/Contra III - The Alien Wars (USA).png", rom: "roms/Contra III - The Alien Wars (U) [!].zip" },
    { title: "EarthBound", cover: "images/EarthBound (USA).png", rom: "roms/Earthbound (U) [!].zip" },
    { title: "Final Fantasy III", cover: "images/Final Fantasy III (USA).png", rom: "roms/Final Fantasy III (U) (V1.1) [!].zip" },
    { title: "Mega Man X", cover: "images/Mega Man X (USA).png", rom: "roms/Mega Man X (U) (V1.1) [!].zip" },
    { title: "Secret of Mana", cover: "images/Secret of Mana (USA).png", rom: "roms/Secret of Mana (U) [!].zip" },
    { title: "Super Castlevania IV", cover: "images/Super Castlevania IV (USA).png", rom: "roms/Super Castlevania IV (U) [!].zip" },
    { title: "Super Ghouls 'n Ghosts", cover: "images/Super Ghouls 'n Ghosts (USA).png", rom: "roms/Super Ghouls 'N Ghosts (U) [!].zip" },
    { title: "Super Mario Kart", cover: "images/Super Mario Kart (USA).png", rom: "roms/Super Mario Kart (U) [!].zip" },
    { title: "Super Mario RPG - Legend of the Seven Stars", cover: "images/Super Mario RPG - Legend of the Seven Stars (USA).png", rom: "roms/Super Mario RPG - Legend of the Seven Stars (U) [!].zip" },
    { title: "Super Mario World 2 - Yoshi's Island", cover: "images/Super Mario World 2 - Yoshi's Island (USA).png", rom: "roms/Super Mario World 2 - Yoshi's Island (U) (M3) (V1.1).zip" },
    { title: "Super Metroid", cover: "images/Super Metroid (USA).png", rom: "roms/Super Metroid (USA, Europe) (En,Ja) (Virtual Console, Classic Mini, Switch Online).zip" },
    { title: "Super Punch-Out!!", cover: "images/Super Punch-Out!! (USA).png", rom: "roms/Super Punch-Out!! (U) [!].zip" }
  ];

  const carousel = document.getElementById('gameCarousel');
  const titleBar = document.querySelector('.title-bar');
  const gametitleBar = document.querySelector('.gametitle-bar .game-title-text');
  let selectedIndex = 0;

  // --- Infinite Carousel Setup ---
  // REMOVE illusion: only render the games array once
  function populateCarousel() {
    carousel.innerHTML = '';
    games.forEach((game, i) => {
      const slot = createGameSlot(game, i);
      carousel.appendChild(slot);
    });
    setTimeout(() => {
      const slots = document.querySelectorAll('.game-slot');
      if (slots[0]) {
        const slot = slots[0];
        const slotRect = slot.getBoundingClientRect();
        const carouselRect = carousel.getBoundingClientRect();
        const slotCenter = slotRect.left - carouselRect.left + carousel.scrollLeft + slotRect.width / 2;
        const carouselCenter = carousel.clientWidth / 2;
        carousel.scrollLeft = slotCenter - carouselCenter;
      }
    }, 0);
    selectedIndex = 0;
    updateTitleBar(games[0]);
    updateSelectedSlot();
  }

  function createGameSlot(game, index) {
    const slot = document.createElement('div');
    slot.classList.add('game-slot');
    slot.setAttribute('role', 'button');
    slot.tabIndex = 0;
    slot.innerHTML = `
      <div class="game-bg"></div>
      <div class="game-cover" style="margin-top:-10px;">
        <img src="${game.cover}" alt="${game.title}">
      </div>
      <div class="game-info">
        <a href="${game.rom}" download style="display:none;">Download ROM</a>
      </div>
    `;
    slot.addEventListener('focus', () => {
      updateTitleBar(game);
      selectedIndex = index;
    });
    slot.addEventListener('mouseenter', () => {
      updateTitleBar(game);
      selectedIndex = index;
    });
    // New click event to download the ROM when clicking the slot
    slot.addEventListener('click', (e) => {
      playSound(soundClick);
      // Use a real anchor and trigger click after a short delay to allow sound
      setTimeout(() => {
        const anchor = document.createElement('a');
        anchor.href = game.rom;
        anchor.setAttribute('download', '');
        document.body.appendChild(anchor);
        // For Chrome: must be user-initiated, so use MouseEvent
        anchor.dispatchEvent(new MouseEvent('click', {bubbles: true, cancelable: true, view: window}));
        document.body.removeChild(anchor);
      }, 120);
      e.preventDefault();
      e.stopPropagation();
    });
    slot.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ' || e.keyCode === 13 || e.keyCode === 32) {
        playSound(soundClick);
        setTimeout(() => {
          const anchor = document.createElement('a');
          anchor.href = game.rom;
          anchor.setAttribute('download', '');
          document.body.appendChild(anchor);
          anchor.dispatchEvent(new MouseEvent('click', {bubbles: true, cancelable: true, view: window}));
          document.body.removeChild(anchor);
        }, 120);
        e.preventDefault();
        e.stopPropagation();
      }
    });
    return slot;
  }

  // Update centering logic to use selectedIndex
  function scrollSelectedIntoView() {
    const slots = document.querySelectorAll('.game-slot');
    if (slots[selectedIndex]) {
      const slot = slots[selectedIndex];
      const slotRect = slot.getBoundingClientRect();
      const carouselRect = carousel.getBoundingClientRect();
      const slotCenter = slotRect.left - carouselRect.left + carousel.scrollLeft + slotRect.width / 2;
      const carouselCenter = carousel.clientWidth / 2;
      carousel.scrollLeft = slotCenter - carouselCenter;
    }
  }

  // Update updateSelectedSlot to use selectedIndex % games.length for .selected
  function updateSelectedSlot() {
    const slots = document.querySelectorAll('.game-slot');
    slots.forEach((slot, i) => {
      if (i === selectedIndex) {
        slot.classList.add('selected');
      } else {
        slot.classList.remove('selected');
      }
    });
    scrollSelectedIntoView();
  }

  function updateTitleBar(game) {
    if (titleBar && game) {
      titleBar.textContent = 'SNES Mini Menu';
    }
    if (gametitleBar && game) {
      gametitleBar.textContent = game.title;
    }
    updateSelectedSlot();
  }

  populateCarousel();
  setTimeout(() => scrollSelectedIntoView(), 0); // Always scroll to the selected game on load

  // Keyboard navigation for carousel
  document.addEventListener('keydown', (e) => {
    const slots = document.querySelectorAll('.game-slot');
    if (e.key === 'ArrowRight') {
      selectedIndex++;
      if (selectedIndex >= games.length) {
        // If we go past the end of the array, loop back to the start
        selectedIndex = 0;
        scrollSelectedIntoView();
      }
      updateTitleBar(games[selectedIndex]);
      playSound(soundScroll);
    } else if (e.key === 'ArrowLeft') {
      selectedIndex--;
      if (selectedIndex < 0) {
        // If we go before the start of the array, loop to the end
        selectedIndex = games.length - 1;
        scrollSelectedIntoView();
      }
      updateTitleBar(games[selectedIndex]);
      playSound(soundScroll);
    }
  });
</script>

</body>
</html>
